# KvikkPress Templates

## layout.html

KvikkPress renders every page through `layout.html`. The template receives these variables:

| Variable | Type | Description |
|---|---|---|
| `title` | `string` | Page title from frontmatter |
| `content` | `string` | Rendered HTML (use `{{ content \| safe }}`) |
| `toc` | `TocItem[]` | Table of contents entries (h2/h3) |
| `currentPath` | `string` | Current URL path (e.g. `/guides/auth`) |
| `meta` | `PageMeta` | All frontmatter data |
| `siteTitle` | `string` | From config |
| `contentTree` | `ContentNode[]` | Full page hierarchy for sidebar |
| `fileHashes` | `Record<string, string>` | Cache-busting hashes |
| `year` | `number` | Current year |
| `version` | `string` | From config |
| `...templateGlobals` | | Your custom variables |

## kvikkpress.js

`static/kvikkpress.js` is framework integration code — sidebar toggle, dark mode, TOC highlighting, code copy buttons, Copy-for-LLM, and toast notifications. All vanilla JS, no dependencies.

**This file is owned by KvikkPress.** Upgrade by copying the latest version from the [KvikkPress repository](https://github.com/halebase/kvikkpress/blob/main/examples/start/static/kvikkpress.js). Put your own JS in a separate file.

### DOM contract

`kvikkpress.js` expects these elements from `layout.html`. All lookups use optional chaining — missing elements are silently skipped, so you can omit features you don't need.

| Selector | Element | Purpose |
|---|---|---|
| `#mobile-menu-btn` | `<button>` | Toggles sidebar on mobile (< 768px) |
| `#mobile-overlay` | `<div class="hidden">` | Dark overlay behind open sidebar |
| `#sidebar` | `<aside>` | Sidebar nav, toggled via `-translate-x-full` / `translate-x-0` |
| `#theme-toggle` | `<button>` | Cycles theme: system → dark/light → system |
| `#theme-icon-light` | `<svg class="hidden">` | Sun icon, visible when current theme is light |
| `#theme-icon-dark` | `<svg class="hidden">` | Moon icon, visible when current theme is dark |
| `#copy-llm-link` | `<button data-path="{{ currentPath }}">` | "Copy for LLM" — POSTs to server, copies result |
| `.toc-link[data-id]` | `<a>` | TOC links, highlighted based on scroll position |
| `.content h2[id]`, `.content h3[id]` | headings | Observed by IntersectionObserver for TOC tracking |
| `pre` | `<pre>` | Code blocks — copy button injected dynamically |

**localStorage:** `themeMode` — `"light"`, `"dark"`, or absent (= follow system preference).

### Copy for LLM

Two elements in the breadcrumb bar:

1. **"Raw .md"** — an `<a>` link to `{{ currentPath }}.md`
2. **"Copy for LLM"** — `<button id="copy-llm-link" data-path="{{ currentPath }}">`

The button only needs `data-path`. The JS handler POSTs to `/api/llm-copy?path=...` and copies the `{ text }` response to clipboard. The server constructs the full clipboard text (site title, page URL with token, usage instructions). No client-side text construction.

## Cache busting

Use `fileHashes` in script and link tags:

```html
<link href="/static/output.css?h={{ fileHashes['/static/output.css'] }}" rel="stylesheet">
<script src="/static/kvikkpress.js?h={{ fileHashes['/static/kvikkpress.js'] }}"></script>
```

URLs with `?h=<hash>` get `Cache-Control: public, max-age=31536000, immutable` (1 year). Without the hash parameter: `Cache-Control: no-cache`. The hash changes when file content changes, so browsers fetch fresh automatically.

## CSS

Edit `main.css` for styles. **Never edit `_build/output.css`** — it's auto-generated by Tailwind. In dev mode, the server maps `/static/output.css` to `_build/output.css` automatically.
